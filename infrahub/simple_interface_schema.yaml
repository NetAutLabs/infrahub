# yaml-language-server: $schema=https://schema.infrahub.app/infrahub/schema/latest.json
---
version: "1.0"
nodes:
  - name: Interface
    namespace: Network
    include_in_menu: true
    icon: "mdi:ethernet"
    display_labels:
      - "name__value"
    uniqueness_constraints:
    - ["device", "name__value"]
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: management
        kind: Boolean
        optional: true
        description: "Management interface"
      - name: mode
        kind: Dropdown
        choices:
          - name: access
            label: Access
            description: "Access port"
            color: "#7fbf7f"
          - name: access_trunk
            label: Access Trunk
            description: "Trunk port to host"
            color: "#7f7fff"
          - name: trunk
            label: Trunk
            description: "Trunk port"
            color: "#7f7f7f"
          - name: routed
            label: Routed
            description: "Routed port"
            color: "#ffd27f"
          - name: shutdown
            label: Shutdown
            description: "Shutdown port"
            color: "#bfbfbf"
    relationships:
      - name: device
        peer: NetworkDevice
        identifier: "device__interface"
        optional: false
        cardinality: one
        kind: Parent
      - name: ip_address
        peer: IpamIPAddress
        identifier: "interface__address"
        cardinality: one
        optional: true
        kind: Attribute
      - name: access_vlan
        peer: NetworkL2Domain
        identifier: "interface__access_vlan"
        cardinality: one
        optional: true
        kind: Attribute
      - name: trunk_vlans
        peer: NetworkL2Domain
        identifier: "interface__trunk_vlan"
        cardinality: many
        optional: true
        kind: Attribute
  - name: Device
    namespace: Network
    display_labels:
      - "name__value"
    icon: "mdi:router-network"
    attributes:
      - name: name
        kind: Text
        unique: true
      - name: description
        kind: Text
        optional: true
      # connection_options
      - name: status
        kind: Dropdown
        choices:
          - name: active
            label: Active
            description: "Device is active"
            color: "#7fbf7f"
          - name: maintenance
            label: Maintenance
            description: "Device is in maintenance"
            color: "#ffd27f"
          - name: offline
            label: Offline
            description: "Device is offline"
            color: "#bfbfbf"
    relationships:
      - name: interfaces
        cardinality: many
        peer: NetworkInterface
        kind: Component
  - name: L2Domain
    namespace: Network
    label: L2 Domain
    icon: "mdi:cloud"
    display_labels:
      - "name__value"
      - "vlan__value"
    attributes:
      - name: name
        kind: Text
      - name: vlan
        kind: Number
    relationships:
      - name: l3domain
        cardinality: one
        peer: NetworkL3Domain
        kind: Attribute
      - name: access_vlan
        peer: NetworkInterface
        identifier: "interface__access_vlan"
        cardinality: many
        optional: true
        kind: Component
      - name: trunk_vlans
        peer: NetworkInterface
        identifier: "interface__trunk_vlan"
        cardinality: many
        optional: true
        kind: Component
  - name: L3Domain
    namespace: Network
    label: L3 Domain
    icon: "mdi:cloud"
    display_labels:
      - "name__value"
      - "network__value"
    attributes:
      - name: name
        kind: Text
      - name: network
        kind: IPNetwork
    relationships:
      - name: l2domain
        cardinality: one
        peer: NetworkL2Domain
        kind: Attribute
  - name: IPAddress
    namespace: Ipam
    description: "IP Address"
    label: "IP Address"
    icon: "mdi:ip-outline"
    default_filter: address__value
    order_by:
      - "address__value"
    display_labels:
      - address__value
    uniqueness_constraints:
      - ["prefix", "address__value"]
    attributes:
      - name: address
        kind: IPHost
      - name: description
        kind: Text
        optional: true
    relationships:
      - name: interface
        peer: NetworkInterface
        kind: Attribute
        optional: true
        cardinality: one
      - name: prefix
        peer: IpamPrefix
        identifier: "prefix__address"
        kind: Parent
        optional: false
        cardinality: one
  - name: Prefix
    namespace: Ipam
    description: "IPv4 or IPv6 network (with mask)"
    icon: "mdi:ip-network"
    label: "Prefix"
    default_filter: prefix__value
    order_by:
      - prefix__value
    display_labels:
      - prefix__value
    attributes:
      - name: prefix
        kind: IPNetwork
      - name: description
        kind: Text
        optional: true
      - name: status
        kind: Dropdown
        choices:
          - name: active
            label: Active
            description: "Prefix is active"
            color: "#7fbf7f"
          - name: deprecated
            label: Deprecated
            description: "Prefix should not be used"
            color: "#ffd27f"
    relationships:
      - name: vlan
        peer: NetworkL2Domain
        optional: true
        cardinality: one
        kind: Attribute
      - name: ip_addresses
        peer: IpamIPAddress
        identifier: "prefix__address"
        cardinality: many
        kind: Component
